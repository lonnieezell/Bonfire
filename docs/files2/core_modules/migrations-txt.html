<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">

<html><head><title>Migrations - Bonfire</title><meta name=”viewport” content=”initial-scale=1.0? /><link rel="stylesheet" type="text/css" href="../../styles/main.css"><script language=JavaScript src="../../javascript/main.js"></script><script language=JavaScript src="../../javascript/prettify.js"></script><script language=JavaScript src="../../javascript/searchdata.js"></script></head><body class="ContentPage" onLoad="NDOnLoad();prettyPrint();"><script language=JavaScript><!--
if (browserType) {document.write("<div class=" + browserType + ">");if (browserVer) {document.write("<div class=" + browserVer + ">"); }}// --></script>

<!--  Generated by Natural Docs, version 1.5 -->
<!--  http://www.naturaldocs.org  -->

<!-- saved from url=(0026)http://www.naturaldocs.org -->




<div id="Container"><div id=Menu><div class=MTitle>Bonfire<div class=MSubTitle>Faster CodeIgniter Development</div></div><div class=MEntry><div class=MFile><a href="../welcome-txt.html">Welcome to Bonfire</a></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent1')">Basic Info</a><div class=MGroupContent id=MGroupContent1><div class=MEntry><div class=MFile><a href="../basic_info/requirements-txt.html">Server Requirements</a></div></div><div class=MEntry><div class=MFile><a href="../basic_info/license-txt.html">License Agreement</a></div></div><div class=MEntry><div class=MFile><a href="../basic_info/changelog-txt.html">Changelog</a></div></div><div class=MEntry><div class=MFile><a href="../basic_info/credits-txt.html">Credits</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent2')">Installation</a><div class=MGroupContent id=MGroupContent2><div class=MEntry><div class=MFile><a href="../installation/installing-txt.html">Fresh Installation</a></div></div><div class=MEntry><div class=MFile><a href="../installation/troubleshooting-txt.html">Troubleshooting Guide</a></div></div><div class=MEntry><div class=MFile><a href="../installation/upgrading-txt.html">Upgrading</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent3')">Introduction</a><div class=MGroupContent id=MGroupContent3><div class=MEntry><div class=MFile><a href="../introduction/getting_started-txt.html">Getting Started</a></div></div><div class=MEntry><div class=MFile><a href="../introduction/overview-txt.html">Bonfire Overview</a></div></div><div class=MEntry><div class=MFile><a href="../introduction/concepts-txt.html">Important Concepts</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent4')">General Topics</a><div class=MGroupContent id=MGroupContent4><div class=MEntry><div class=MFile><a href="../general_topics/ajax-txt.html">AJAX in Bonfire</a></div></div><div class=MEntry><div class=MFile><a href="../general_topics/controllers-txt.html">Base Controllers</a></div></div><div class=MEntry><div class=MFile><a href="../general_topics/contexts-txt.html">Contexts</a></div></div><div class=MEntry><div class=MFile><a href="../general_topics/module_overview-txt.html">Modules Overview</a></div></div><div class=MEntry><div class=MFile><a href="../general_topics/application_folder-txt.html">Moving the Application Folder</a></div></div><div class=MEntry><div class=MFile><a href="../general_topics/site_areas-txt.html">Site Areas</a></div></div><div class=MEntry><div class=MFile><a href="../general_topics/event_hooks-txt.html">System Events</a></div></div><div class=MEntry><div class=MFile><a href="../general_topics/auth_notes-txt.html">Understanding Authentication</a></div></div><div class=MEntry><div class=MFile><a href="../general_topics/unit_testing-txt.html">Unit Testing</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent5')">Core Modules</a><div class=MGroupContent id=MGroupContent5><div class=MEntry><div class=MFile><a href="activities-txt.html">Activities</a></div></div><div class=MEntry><div class=MFile><a href="database-txt.html">Database</a></div></div><div class=MEntry><div class=MFile><a href="emailer-txt.html">Emailer</a></div></div><div class=MEntry><div class=MFile><a href="logs-txt.html">Logs</a></div></div><div class=MEntry><div class=MFile id=MSelected>Migrations</div></div><div class=MEntry><div class=MFile><a href="permissions-txt.html">Permissions</a></div></div><div class=MEntry><div class=MFile><a href="roles-txt.html">Roles</a></div></div><div class=MEntry><div class=MFile><a href="tester-txt.html">Tester</a></div></div><div class=MEntry><div class=MFile><a href="ui-txt.html">UI</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent6')">Designers</a><div class=MGroupContent id=MGroupContent6><div class=MEntry><div class=MFile><a href="../designers/introduction-txt.html">Designer Introduction</a></div></div><div class=MEntry><div class=MFile><a href="../designers/views-txt.html">Views and Layouts</a></div></div><div class=MEntry><div class=MFile><a href="../designers/blocks-txt.html">Blocks</a></div></div><div class=MEntry><div class=MFile><a href="../designers/data-txt.html">Dynamic Data</a></div></div><div class=MEntry><div class=MFile><a href="../designers/flash-txt.html">Flash Messages</a></div></div><div class=MEntry><div class=MFile><a href="../designers/ajax-txt.html">Handling AJAX</a></div></div><div class=MEntry><div class=MFile><a href="../designers/utilities-txt.html">Template Utility Functions</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent7')">Tutorials</a><div class=MGroupContent id=MGroupContent7><div class=MEntry><div class=MFile><a href="../../files3/todo-txt.html">ToDo Module</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent16')">Class Reference</a><div class=MGroupContent id=MGroupContent16><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent8')">Core Overrides</a><div class=MGroupContent id=MGroupContent8><div class=MEntry><div class=MFile><a href="../../files/core/MY_Model-php.html">BF_Model</a></div></div><div class=MEntry><div class=MFile><a href="../../files/core/MY_Controller-php.html">Controllers</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent9')">Models</a><div class=MGroupContent id=MGroupContent9><div class=MEntry><div class=MFile><a href="../../files/core_modules/roles/models/role_model-php.html">Role_model</a></div></div><div class=MEntry><div class=MFile><a href="../../files/core_modules/roles/models/role_permission_model-php.html">Role_permission_model</a></div></div><div class=MEntry><div class=MFile><a href="../../files/core_modules/permissions/models/permission_model-php.html">Permission_model</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent10')">Helpers</a><div class=MGroupContent id=MGroupContent10><div class=MEntry><div class=MFile><a href="../../files/helpers/address_helper-php.html">Address Helper</a></div></div><div class=MEntry><div class=MFile><a href="../../files/helpers/application_helper-php.html">Application Helper</a></div></div><div class=MEntry><div class=MFile><a href="../../files/helpers/MY_array_helper-php.html">Array Helper</a></div></div><div class=MEntry><div class=MFile><a href="../../files/helpers/config_file_helper-php.html">Config File Helper</a></div></div><div class=MEntry><div class=MFile><a href="../../files/helpers/MY_date_helper-php.html">MY_date_helper</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent11')">Libraries</a><div class=MGroupContent id=MGroupContent11><div class=MEntry><div class=MFile><a href="../../files/libraries/assets-php.html">Assets</a></div></div><div class=MEntry><div class=MFile><a href="../../files/libraries/Console-php.html">Console</a></div></div><div class=MEntry><div class=MFile><a href="../../files/libraries/events-php.html">Events Class</a></div></div><div class=MEntry><div class=MFile><a href="../../files/libraries/template-php.html">Template</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent15')">Core Modules</a><div class=MGroupContent id=MGroupContent15><div class=MEntry><div class=MFile><a href="../../files/core_modules/activities/models/activity_model-php.html">Activities</a></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent12')">Emailer</a><div class=MGroupContent id=MGroupContent12><div class=MEntry><div class=MFile><a href="../../files/core_modules/emailer/libraries/emailer-php.html">Emailer Library</a></div></div><div class=MEntry><div class=MFile><a href="../../files/core_modules/emailer/controllers/settings-php.html">Emailer Settings Context</a></div></div></div></div></div><div class=MEntry><div class=MFile><a href="../../files/core_modules/install/controllers/install-php.html">Install</a></div></div><div class=MEntry><div class=MFile><a href="../../files/core_modules/logs/controllers/developer-php.html">Logs Developer Context</a></div></div><div class=MEntry><div class=MFile><a href="../../files/core_modules/migrations/libraries/Migrations-php.html">Migrations</a></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent13')">Tester</a><div class=MGroupContent id=MGroupContent13><div class=MEntry><div class=MFile><a href="../../files/core_modules/tester/libraries/Base_Tester-php.html">Base_Tester</a></div></div><div class=MEntry><div class=MFile><a href="../../files/core_modules/tester/libraries/Unit_Tester-php.html">Unit_Test</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent14')">Users</a><div class=MGroupContent id=MGroupContent14><div class=MEntry><div class=MFile><a href="../../files/core_modules/users/libraries/auth-php.html">Auth Library</a></div></div><div class=MEntry><div class=MFile><a href="../../files/core_modules/users/controllers/users-php.html">Users Controller</a></div></div><div class=MEntry><div class=MFile><a href="../../files/core_modules/users/models/user_model-php.html">User Model</a></div></div></div></div></div></div></div></div></div></div></div><div class=MEntry><div class=MFile><a href="../../files/core_modules/modulebuilder/controllers/developer-php.html">bonfire/.../controllers/<wbr>developer.php</a></div></div><div class=MEntry><div class=MFile><a href="../../files/core_modules/roles/controllers/settings-php.html">bonfire/.../controllers/<wbr>settings.php</a></div></div><div class=MEntry><div class=MFile><a href="../../files/core_modules/subnav/controllers/subnav-php.html">bonfire/.../controllers/<wbr>subnav.php</a></div></div><div class=MEntry><div class=MFile><a href="../../files/core_modules/modulebuilder/views/files/controller-php.html">bonfire/.../files/<wbr>controller.php</a></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent17')">Index</a><div class=MGroupContent id=MGroupContent17><div class=MEntry><div class=MIndex><a href="../../index/General.html">Everything</a></div></div><div class=MEntry><div class=MIndex><a href="../../index/Classes.html">Classes</a></div></div><div class=MEntry><div class=MIndex><a href="../../index/Functions.html">Functions</a></div></div><div class=MEntry><div class=MIndex><a href="../../index/Variables.html">Variables</a></div></div><div class=MEntry><div class=MIndex><a href="../../index/Files.html">Files</a></div></div></div></div></div><script type="text/javascript"><!--
var searchPanel = new SearchPanel("searchPanel", "HTML", "../../search");
--></script><div id=MSearchPanel class=MSearchPanelInactive><input type=text id=MSearchField value=Search onFocus="searchPanel.OnSearchFieldFocus(true)" onBlur="searchPanel.OnSearchFieldFocus(false)" onKeyUp="searchPanel.OnSearchFieldChange()"><select id=MSearchType onFocus="searchPanel.OnSearchTypeFocus(true)" onBlur="searchPanel.OnSearchTypeFocus(false)" onChange="searchPanel.OnSearchTypeChange()"><option  id=MSearchEverything selected value="General">Everything</option><option value="Classes">Classes</option><option value="Files">Files</option><option value="Functions">Functions</option><option value="Variables">Variables</option></select></div><script language=JavaScript><!--
HideAllBut([5], 18);// --></script></div><!--Menu-->


<div id=Content><div class="CSection"><div class=CTopic id=MainTopic><h1 class=CTitle><a name="Migrations"></a>Migrations</h1><div class=CBody><p>The Migrations Module expands on the Migrations library provided by CodeIgniter to allow two types of migrations (dbforge or raw SQL), and separate migrations for Bonfire core, your application, and each module.&nbsp; This provides you, the developer, with the utmost flexibility in versioning your database.</p><p>The migration UI can be found by navigating to Developer / Database Tools / Migrations.</p><!--START_ND_SUMMARY--><div class=Summary><div class=STitle>Summary</div><div class=SBorder><table border=0 cellspacing=0 cellpadding=0 class=STable><tr class="SMain"><td class=SEntry><a href="#Migrations" >Migrations</a></td><td class=SDescription>The Migrations Module expands on the Migrations library provided by CodeIgniter to allow two types of migrations (dbforge or raw SQL), and separate migrations for Bonfire core, your application, and each module. </td></tr><tr class="SGeneric SIndent1 SMarked"><td class=SEntry><a href="#Enabling_Migrations" >Enabling Migrations</a></td><td class=SDescription>A clean install has migrations enabled by default. </td></tr><tr class="SGeneric SIndent1"><td class=SEntry><a href="#Migration_Spheres" >Migration Spheres</a></td><td class=SDescription>Bonfire supports three separate spheres of migrations: Core, Application, and Module.</td></tr><tr class="SGeneric SIndent1 SMarked"><td class=SEntry><a href="#Migration_Types" >Migration Types</a></td><td class=SDescription>Unlike the migrations that CodeIgniter provides, Bonfire&rsquo;s migrations support two different types of migration files, allowing you to work the way that works best for you.</td></tr><tr class="SGeneric SIndent1"><td class=SEntry><a href="#Creating_a_Migration_File" >Creating a Migration File</a></td><td class=SDescription><b>File Name</b></td></tr></table></div></div><!--END_ND_SUMMARY--></div></div></div>

<div class="CGeneric"><div class=CTopic><h3 class=CTitle><a name="Enabling_Migrations"></a>Enabling Migrations</h3><div class=CBody><p>A clean install has migrations enabled by default.&nbsp; However, it is recommended when you move to production to disable migrations for security.</p><p>To disable migrations, edit the following line in <u>bonfire/application/core modules/migrations/config/migrations.php</u> to be false.</p><blockquote><pre>$config['migrations_enabled'] = true;</pre></blockquote></div></div></div>

<div class="CGeneric"><div class=CTopic><h3 class=CTitle><a name="Migration_Spheres"></a>Migration Spheres</h3><div class=CBody><p>Bonfire supports three separate spheres of migrations: Core, Application, and Module.</p><ul><li><b>Core</b> migrations are migrations used for Bonfire itself.&nbsp; This keeps the core migration numbers seperate from your application.&nbsp; Core Migration files are located under <u>bonfire/application/db/migrations/core</u>.&nbsp; You should not place any of your applications here.</li><li><b>Application</b> migrations are any migration files that are specific to your application.&nbsp; They follow their own unique numbering scheme that keeps them split from the core.&nbsp; Application Migration files should be placed under _bonfire/application/db/migrations/_.</li><li><b>Module</b> migrations are module-specific.&nbsp; These are intended to help you keep your modules completely self-contained and able to drop into another project.&nbsp; They follow their own unique numbering sequence.&nbsp; Module Migrations should be kept in the module&rsquo;s folder, like <u>bonfire/modules/my module/migrations</u>.</li></ul></div></div></div>

<div class="CGeneric"><div class=CTopic><h3 class=CTitle><a name="Migration_Types"></a>Migration Types</h3><div class=CBody><p>Unlike the migrations that CodeIgniter provides, Bonfire&rsquo;s migrations support two different types of migration files, allowing you to work the way that works best for you.</p><ul><li><b>dbForge</b> migrations are the standard CodeIgniter migrations.&nbsp; They are completely self-contained and all code that is to be run for the migration to happen is contained within the up() and down() methods.</li><li><b>SQL</b> migrations are a unique addition to Bonfire.&nbsp; They allow you to use raw SQL commands instead of dbforge/dbutil commands that are sometimes unweildy.&nbsp; SQL migrations are best used when you know that you will only be using MySQL databases and can customize your SQL commands to that database.</li></ul></div></div></div>

<div class="CGeneric"><div class=CTopic><h3 class=CTitle><a name="Creating_a_Migration_File"></a>Creating a Migration File</h3><div class=CBody><p><b>File Name</b></p><p>Migration files MUST be numbered sequentially.&nbsp; The rest of the file name is up to you, but it is recommended that the name describe what actually happens in the file.&nbsp; Like &ldquo;Install_initial_tables&rdquo;, &ldquo;Permissions_upgrade&rdquo;, etc.&nbsp; It must end with the <u>.php</u> extension.</p><h4 class=CHeading>Some examples</h4><blockquote><pre>001_Install_initial_tables.php
002_Version_02_upgrades.php
003_Permissions_upgrade.php</pre></blockquote><p><b>File Structure</b></p><p>The file is a standard PHP class, that must follow three simple rules</p><ul><li>The class must be named the same as the file, except the number is replaced by <u>Migration</u>.&nbsp; For a file named <u>001 Install initial tables.php</u>, the class would be named <u>Migration Install initial tables</u>.&nbsp; The name is case-sensitive.</li><li>The class MUST extend the <u>Migration</u> class</li><li>The class MUST include two methods: up() and down().&nbsp; As the names imply, the <b>up()</b> method is ran whenever you are migrating up to that version.&nbsp; The <b>down()</b> method is ran whenever uninstalling that migration.</li></ul><h4 class=CHeading>A Skeleton migration</h4><blockquote><pre>&lt;?php if (!defined('BASEPATH')) exit('No direct script access allowed');

class Migration_Install_initial_tables extends Migration {

  function up() {
      ...
  }

  //--------------------------------------------------------------------

  function down() {
      ...
  }

  //--------------------------------------------------------------------
}</pre></blockquote><p><b>SQL Migrations</b></p><p>When creating a SQL migration, there are two changes that you must make to the above skeleton.</p><ul><li>You must provide a class variable named <u>$migration type</u> that is equal to <u>sql</u>.</li><li>In both the up() and down() methods, you must return your SQL commands as a single string.&nbsp; This SQL may contain multiple commands, as long as they are separated by a colon.</li></ul><blockquote><pre>&lt;?php if (!defined('BASEPATH')) exit('No direct script access allowed');

class Migration_Install_initial_tables extends Migration {

  public $migration_type = 'sql';

  function up() {
      $sql = &quot;...&quot;;

      return $sql;
  }

  //--------------------------------------------------------------------

  function down() {
      $sql = &quot;...&quot;;

      return $sql;
  }

  //--------------------------------------------------------------------
}</pre></blockquote></div></div></div>

</div><!--Content--></div>


<div id=Footer><a href="http://www.naturaldocs.org">Generated by Natural Docs</a></div><!--Footer-->



<!--START_ND_TOOLTIPS-->
<!--END_ND_TOOLTIPS-->




<div id=MSearchResultsWindow><iframe src="" frameborder=0 name=MSearchResults id=MSearchResults></iframe><a href="javascript:searchPanel.CloseResultsWindow()" id=MSearchResultsWindowClose>Close</a></div>


<script language=JavaScript><!--
if (browserType) {if (browserVer) {document.write("</div>"); }document.write("</div>");}// --></script></body></html>